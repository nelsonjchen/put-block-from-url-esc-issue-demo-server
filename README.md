# Azure Storage Copy from URL Escaping Issue Demo/Debug

This test server tool was made to demonstrate and record that Azure Storage's
"Put Block From URL" erroneously escapes the path before requesting it from the remote server. The URL "
x-ms-source-range" changes "%2F" to a "/" which can make certain URLs unable to be requested.

URLs such as the one below will not work (This is already expired, but that's not why it doesn't work):

https://00f74ba44b071b761059aef3fd79738daea1be7829-apidata.googleusercontent.com/download/storage/v1/b/dataliberation/o/20211113T212502Z%2F-4311693717716012545%2F498d83a5-1ab3-4a79-815f-e5cfda855e7a%2F1%2F869777c3-49ff-4d4e-a932-230a6b0b2a78?jk=AFshE3XT7l4gO3olRD23ASyAuaK-Lbi1Z4oc4eMBje8eLdA1mHPk-VeNNMCDno2sDlRKTKD2Nqau1HdkE9nX5f462yylgcSu5kmIknW0lU-1Xx3Mb8OnO5L-DMq3W8xslAI6vlKnqrKaTztfOKSQOfn-5XWf4OuiuDCTdstSSCcsNDMu8b4NX6cnuRhGRdVonqtH3lf9TV7fIBJMchxy3l-i3W_tiGHO7NP9B2Rnvo2uJP7-pgbfxH_ki0DLerQhKK4hRx6KeHWfXL2XT80lLVYwfS2dk5XVAplFIIV7Lp9H7x3HERQzR7_1JshhluQyoG6Vqv7gRYyav8S7PrwkKXStCho5fc85ErZ0dQqJXmvNqCtdWCB8-KzIA5-UgjlLcDzk_mVYMUfcr-_i-R-5tA_Rnb0MmavB94aIj9EfEh0g0B6yCRnAHAIuob6EYFTeCVTs7XXBlqlMKF-P0A5L2d47f0pSQrosQUNshoZKKieSl71vD3kiFDZ4OIg5K-yPlkniodFuyRr-hf5LeBIZhMFNozA2nfGOU3cW3i_sJZgNJNf68UK_l1beTDJ5ZKEZ5ot0jgaQ7w_KlLEonaGJM4Lw7oVby-GbqmlFYe2SI9wwxcXURdW88AW4zipqCMOz_N7cBYC0zm1t4TRSW2-_uvsQWLQRA_9g8avGn8RIKr8i-ISa7sfMaUQEkY4eOtsV7l3JHNeKjmJtxSOJPwg487Cv0htwGt_3Kd6IbyFOb1l0l9wKtkIxkQqliTvAK7VXZUGr1Cdsbbhq1qy3AF1aMVPA1vghV2TOOr5rOzVkRUmTLQzU5WfsYOoNcKjJ7mPvuOirFkKvSHzBQDvZ8_B2RgwT7zMZ7LsjAhG1zS3eDTijUMi9QEM_FYkugRpZ36eg9SZWrEbHCp36y0kL7QK8gZHVP6ePvOqujXG1BCryrxp5UQ9AhZS3szhe54MDf1877LTEmCH5_utBvQqF31dlinmEWiL4YTwiSEwwUToJ38H7gmI-CWErYJsJylmuOSfUoJFpELSRi4Qw4fF-figbaB3w_BNhXvEBdUsMeSNkBkU5u4nwAfG8IJ6TxkyZZKgK4uIhG1R7mr7QaRJ_bizIRVUl&isca=1

Requesting the above URL results in a 404 from Azure's PutBlockFromURL.

Requesting the below URL works fine:

https://00f74ba44bd3dd2f1d97289f6e0ceb51a63437f253-apidata.googleusercontent.com/download/storage/v1/b/test-static/o/hello.txt?jk=AFshE3VCZRX_UsJBHc-xcEQPcZl4d92BUKoBV1R57rMl52cBAWnC8X7RNIy-P0MzLwnhPgX-DVXHyjCeRjPfDiuyD4Nah_-j8E6gPZlAHBAY5YV_Yk7RK1rnS4So3IClz3u1kqGBquQy4S0KoNBqy85Dyqjhhyi4wMf6EcGX_hTPwJjU4TDfYWXIPwQhL9CQkI6Uje-aXO-yKxsIEJMSvwHPmlgaqDxjMN2VG9Tt7GO9RAuWo2Mxy38GZ2bfAcyv8QgfdbB9ueRxu5Ax9QZyCT4DwOTSyUcmsGR8yL0CSbJ3J15Vy5dViPT4b5vToqT81lkxkwIhpBobsEjoT-Cm9c_2uJsvz16M4LveHYz8pBsElRAlEX_dBKS9wD5FGLmYmUibRBQ-buLe93jSeLowHkUebVu52tt2dmiYBqMLFL2i4PZPjzYI8N4eXz9N8p2j3rtdzJBmE8zNZhUKYoW1bBPmspKxdC9VJqXJ6YCSlC1bi7eh8Y1SQAavWiIXo_aEVhXln1K77r22IW1PIs8ibNOcFcjKJDJB64BFCNp-YSeS9inGlTyAD86hfIWBi7rtYTcQXJLpL4NQfdrq3S4lGrmydvcybkBA3O8G34qBeJUQuUfCsmhs1lul2_VbpNvnm9eIHzdDR0B0tBxMS7VCMh6ZwKwvp7NhhUmhYRtS7BLWkvn_7V8gcdho-nsScOcLZBWM_o1Ld6xdObkkFYKPeDtLKtV4DDUZ2D5XlmYWyAqdN6tEZp7LuZaWpIF5FWRdtgjqgZyj0pZnDloYp9TVjHyUW7kPK-Mfw2ce_J18kc7JtFgRdvay006KbbOCkUGQbf_GJN3o-Im0m2mHZgc9LVoAgTk_3ubyYet8Q1UmdNPkxJRV_cCqQpMdMPXBCv7hETBGWER0nI6Ix0bYKLbG-kdm8R6gDNEMLFnN46vvQMFZjzasK_QaJhIAKBOVZC0&isca=1

This working URL does not have a "%2F" before the query string.

URLs such as this are generated when requesting data from Google's in a browser that seem to reside on a Google Storage
Bucket. They work with cURL as well as wget. The URL above is what Google ultimately redirects to when a Google Takeout
archive is requested. A similar URL can be generated by uploading a file into Google Cloud Storage and downloading the
file from within their Web UI Console with the non-public link.

There are certainly more URLs such as this that may exist in the wild and outside of Google infrastructure.

This tool logs to STDOUT the URL that was requested, some metadata of the request, and returns to the requester what
path was received.

Additionally, there are two special paths that will return different codes for testing and demonstration. The
capitalization matters as well, even for the escaped characters.

* "/red/blue.txt" will return a 404 . This is NOT valid.
* "/red%2Fblue.txt" will return a 200 . This is valid and like the non-working Google URL described.

